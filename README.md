# ECH-Workers Client

ä¸€ä¸ªåŸºäº Tauri å¼€å‘çš„ ECH-Workers ä»£ç†å®¢æˆ·ç«¯ï¼Œæä¾›å›¾å½¢åŒ–ç•Œé¢æ¥ç®¡ç†å’Œè¿è¡Œ ECH-Workers ä»£ç†æœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸŒ **å¤šæœåŠ¡å™¨é…ç½®ç®¡ç†** - æ”¯æŒæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤å¤šä¸ªæœåŠ¡å™¨é…ç½®
- ğŸ”§ **å®Œæ•´çš„ä»£ç†å‚æ•°é…ç½®** - æ”¯æŒæ‰€æœ‰ ech-workers.exe å‚æ•°
- ğŸ–¥ï¸ **ç°ä»£åŒ–å›¾å½¢ç•Œé¢** - åŸºäº HTML/CSS/JavaScript çš„ç”¨æˆ·å‹å¥½ç•Œé¢
- ğŸ”„ **ç³»ç»Ÿä»£ç†é›†æˆ** - è‡ªåŠ¨é…ç½®ç³»ç»Ÿä»£ç†è®¾ç½®
- ğŸš€ **å¼€æœºè‡ªå¯åŠ¨** - æ”¯æŒå¼€æœºè‡ªåŠ¨å¯åŠ¨ä»£ç†æœåŠ¡
- ğŸ“‹ **å®æ—¶æ—¥å¿—ç›‘æ§** - å®æ—¶æ˜¾ç¤ºä»£ç†è¿è¡Œæ—¥å¿—
- ğŸ¯ **æ‰˜ç›˜å›¾æ ‡æ”¯æŒ** - æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜
- ğŸ’¾ **é…ç½®æŒä¹…åŒ–** - è‡ªåŠ¨ä¿å­˜ç”¨æˆ·é…ç½®å’ŒçŠ¶æ€

## ç³»ç»Ÿè¦æ±‚

- Windows 10/11 (ä¸»è¦æ”¯æŒå¹³å°)

## ç¼–è¯‘æ„å»º

### ç¯å¢ƒå‡†å¤‡

1. å®‰è£… Rust (æ¨è 1.70+)
2. å®‰è£… Node.js (æ¨è 18+)
3. å®‰è£…ç³»ç»Ÿä¾èµ–ï¼š
   ```bash
   # Windows
   # å®‰è£… Visual Studio Build Tools æˆ– Visual Studio Community
   
   # Linux
   sudo apt update
   sudo apt install libwebkit2gtk-4.0-dev \
       build-essential \
       curl \
       wget \
       libssl-dev \
       libgtk-3-dev \
       libayatana-appindicator3-dev \
       librsvg2-dev
   ```

### æ„å»ºæ­¥éª¤

1. å…‹éš†é¡¹ç›®ï¼š
   ```bash
   git clone -b client-gui-rust https://github.com/juerson/ech-wk.git
   cd ech-wk
   ```

2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   # å®‰è£… Rust ä¾èµ–
   cargo build
   
   # å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆå¦‚æœæœ‰ï¼‰
   npm install
   ```

3. å¼€å‘æ¨¡å¼è¿è¡Œï¼š
   ```bash
   cargo tauri dev
   ```

4. æ„å»ºå‘å¸ƒç‰ˆæœ¬ï¼š
   ```bash
   cargo tauri build
   ```

æ„å»ºå®Œæˆåï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä½äºï¼š
- Windows: `src-tauri/target/release/ech-workers-client.exe`
- Linux: `src-tauri/target/release/ech-workers-client`
- macOS: `src-tauri/target/release/bundle/macos/ech-workers-client.app`

## ä½¿ç”¨è¯´æ˜

### é¦–æ¬¡ä½¿ç”¨

1. å¯åŠ¨åº”ç”¨ç¨‹åº
2. ç‚¹å‡»"æ–°å¢é…ç½®"åˆ›å»ºæœåŠ¡å™¨é…ç½®
3. å¡«å†™æœåŠ¡å™¨ä¿¡æ¯ï¼š
   - **æœåŠ¡å™¨åœ°å€**ï¼šå¿…éœ€ï¼Œæ ¼å¼ä¸º `your-worker.workers.dev:443`
   - **èº«ä»½ä»¤ç‰Œ**ï¼šå¯é€‰ï¼Œèº«ä»½éªŒè¯ä»¤ç‰Œ
   - **ä¼˜é€‰åœ°å€**ï¼šå¿…éœ€ï¼ŒæŒ‡å®šæœåŠ¡å™¨ IP ç»•è¿‡ DNS
   - **ECH åŸŸå**ï¼šé»˜è®¤ `cloudflare-ech.com`
   - **DOH åœ°å€**ï¼šé»˜è®¤ `dns.alidns.com/dns-query`
   - **ç›‘å¬åœ°å€**ï¼šé»˜è®¤ `127.0.0.1:30000`
   - **è·¯ç”±æ¨¡å¼**ï¼šå…¨å±€ä»£ç†/ç»•è¿‡ä¸­å›½/ä¸æ”¹å˜ä»£ç†

### ä»£ç†æ§åˆ¶

1. **å¯åŠ¨ä»£ç†**ï¼šç‚¹å‡»"å¯åŠ¨ä»£ç†"æŒ‰é’®
2. **åœæ­¢ä»£ç†**ï¼šç‚¹å‡»"åœæ­¢ä»£ç†"æŒ‰é’®
3. **ç³»ç»Ÿä»£ç†**ï¼šå¼€å…³æ§åˆ¶æ˜¯å¦å¯ç”¨ç³»ç»Ÿä»£ç†
4. **å¼€æœºå¯åŠ¨**ï¼šå¼€å…³æ§åˆ¶æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨

### æœåŠ¡å™¨ç®¡ç†

- **æ–°å¢é…ç½®**ï¼šåˆ›å»ºæ–°çš„æœåŠ¡å™¨é…ç½®
- **ä¿å­˜é…ç½®**ï¼šä¿®æ”¹å½“å‰é…ç½®åä¿å­˜
- **åˆ é™¤é…ç½®**ï¼šåˆ é™¤é€‰ä¸­çš„æœåŠ¡å™¨é…ç½®
- **åˆ‡æ¢é…ç½®**ï¼šé€šè¿‡ä¸‹æ‹‰æ¡†åˆ‡æ¢ä¸åŒæœåŠ¡å™¨

### æ—¥å¿—ç›‘æ§

- å®æ—¶æ˜¾ç¤ºä»£ç†è¿è¡Œæ—¥å¿—
- æ”¯æŒæ¸…ç©ºæ—¥å¿—

## é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶è‡ªåŠ¨ä¿å­˜åœ¨ï¼š
- Windows: `%APPDATA%\ECHWorkersClient\config.json`
- Linux: `~/.config/ECHWorkersClient/config.json`
- macOS: `~/Library/Application Support/ECHWorkersClient/config.json`

### é…ç½®æ–‡ä»¶æ ¼å¼

```json
{
  "servers": [
    {
      "id": "server_12345678",
      "name": "é»˜è®¤æœåŠ¡å™¨",
      "server": "example.workers.dev:443",
      "listen": "127.0.0.1:30000",
      "token": "",
      "ip": "",
      "dns": "dns.alidns.com/dns-query",
      "ech": "cloudflare-ech.com",
      "routing_mode": "global"
    }
  ],
  "current_server_id": "server_12345678",
  "last_state": {
    "was_running": false,
    "system_proxy_enabled": false,
    "auto_start_checked": false,
    "preferred_mode": 0
  }
}
```

## å¤–éƒ¨ä¾èµ–

æœ¬ç¨‹åºéœ€è¦ `ech-workers.exe` æ–‡ä»¶ä½äºåŒä¸€ç›®å½•ä¸‹æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å¯åŠ¨è¯¥å¤–éƒ¨è¿›ç¨‹ã€‚

### ech-workers.exe å‚æ•°æ”¯æŒ

ç¨‹åºæ”¯æŒå®Œæ•´çš„ ech-workers.exe å‚æ•°é›†ï¼š

- `-f` : æœåŠ¡ç«¯åœ°å€ï¼ˆå¿…éœ€ï¼‰
- `-l` : æœ¬åœ°ç›‘å¬åœ°å€ï¼ˆé»˜è®¤: 127.0.0.1:30000ï¼‰
- `-token` : èº«ä»½éªŒè¯ä»¤ç‰Œï¼ˆé»˜è®¤: ç©ºï¼‰
- `-ip` : æŒ‡å®šæœåŠ¡ç«¯ IPï¼ˆé»˜è®¤: ç©ºï¼‰
- `-dns` : ECH æŸ¥è¯¢ DoH æœåŠ¡å™¨ï¼ˆé»˜è®¤: dns.alidns.com/dns-queryï¼‰
- `-ech` : ECH æŸ¥è¯¢åŸŸåï¼ˆé»˜è®¤: cloudflare-ech.comï¼‰
- `-routing` : åˆ†æµæ¨¡å¼ï¼ˆé»˜è®¤: globalï¼‰

ç¤ºä¾‹å‘½ä»¤ï¼š
```bash
ech-workers.exe -f your-worker.workers.dev:443 -l 127.0.0.1:30000 -dns dns.alidns.com/dns-query -ech cloudflare-ech.com -routing global
```

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
ech-workers-client/
â”œâ”€â”€ src/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.html         # ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ assets/            # é™æ€èµ„æº
â”‚   â””â”€â”€ style.css          # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ src-tauri/             # Rust åç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.rs        # ä¸»ç¨‹åºå…¥å£
â”‚   â”‚   â”œâ”€â”€ config.rs      # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ external_proxy.rs # å¤–éƒ¨ä»£ç†ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ sysproxy.rs    # ç³»ç»Ÿä»£ç†è®¾ç½®
â”‚   â”‚   â”œâ”€â”€ autostart.rs   # å¼€æœºè‡ªå¯åŠ¨
â”‚   â”‚   â”œâ”€â”€ tray.rs        # ç³»ç»Ÿæ‰˜ç›˜
â”‚   â”‚   â””â”€â”€ lib.rs         # åº“å…¥å£
â”‚   â”œâ”€â”€ Cargo.toml         # Rust ä¾èµ–é…ç½®
â”‚   â””â”€â”€ tauri.conf.json    # Tauri é…ç½®
â””â”€â”€ README.md
â””â”€â”€ release 			   # ç¼–è¯‘åçš„ç¨‹åº(x86_64-pc-windows-msvc)
```

### ä¸»è¦æ¨¡å—

- **main.rs**: Tauri åº”ç”¨ç¨‹åºå…¥å£ï¼Œå¤„ç†å‰ç«¯å‘½ä»¤
- **config.rs**: é…ç½®æ–‡ä»¶ç®¡ç†å’ŒæŒä¹…åŒ–
- **external_proxy.rs**: å¤–éƒ¨ ech-workers.exe è¿›ç¨‹ç®¡ç†
- **sysproxy.rs**: ç³»ç»Ÿä»£ç†è®¾ç½®ï¼ˆWindows æ³¨å†Œè¡¨æ“ä½œï¼‰
- **autostart.rs**: å¼€æœºè‡ªå¯åŠ¨è®¾ç½®
- **tray.rs**: ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡å’Œèœå•

### API æ¥å£

ç¨‹åºæä¾›ä»¥ä¸‹ Tauri å‘½ä»¤æ¥å£ï¼š

- `start_proxy` - å¯åŠ¨ä»£ç†æœåŠ¡
- `stop_proxy` - åœæ­¢ä»£ç†æœåŠ¡
- `get_proxy_status` - è·å–ä»£ç†çŠ¶æ€
- `get_config` / `save_config` - é…ç½®ç®¡ç†
- `get_servers` / `set_current_server` - æœåŠ¡å™¨ç®¡ç†
- `upsert_server` / `delete_server` - æœåŠ¡å™¨æ“ä½œ
- `set_system_proxy` - ç³»ç»Ÿä»£ç†è®¾ç½®
- `set_autostart` / `get_autostart_status` - å¼€æœºå¯åŠ¨
- `get_proxy_output` / `clear_proxy_output` - æ—¥å¿—ç®¡ç†

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ‰¾ä¸åˆ° ech-workers.exe**
   - ç¡®ä¿ ech-workers.exe ä½äºç¨‹åºåŒä¸€ç›®å½•
   - æ£€æŸ¥æ–‡ä»¶æƒé™å’Œå¯æ‰§è¡Œæ€§

2. **ç³»ç»Ÿä»£ç†è®¾ç½®å¤±è´¥**
   - ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œç¨‹åº
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

3. **å¼€æœºå¯åŠ¨å¤±è´¥**
   - ç¡®ä¿ç¨‹åºè·¯å¾„æ­£ç¡®
   - æ£€æŸ¥ç³»ç»Ÿå¯åŠ¨é¡¹æƒé™

4. **é…ç½®æ–‡ä»¶æŸå**
   - åˆ é™¤é…ç½®æ–‡ä»¶ï¼Œç¨‹åºä¼šé‡æ–°åˆ›å»ºé»˜è®¤é…ç½®
   - é…ç½®æ–‡ä»¶ä½ç½®è§ä¸Šè¿°è¯´æ˜

### æ—¥å¿—è°ƒè¯•

ç¨‹åºè¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- é…ç½®åŠ è½½ä¿¡æ¯
- ä»£ç†å¯åŠ¨/åœæ­¢çŠ¶æ€
- é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯

## æ›´æ–°æ—¥å¿—

### v0.1.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºæœ¬çš„ä»£ç†ç®¡ç†åŠŸèƒ½
- å›¾å½¢åŒ–ç•Œé¢
- ç³»ç»Ÿä»£ç†é›†æˆ
- å¼€æœºè‡ªå¯åŠ¨æ”¯æŒ
- ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡(èœå•é¡¹å¼‚å¸¸ï¼Œæ— æ³•ç‚¹å‡»ï¼Œå¿…é¡»æ‰‹åŠ¨æ€æ­»è¿›ç¨‹æ‰èƒ½é€€å‡º)